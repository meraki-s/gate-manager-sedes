<div
  class="container"
  [ngClass]="isMobile ? 'container--mobile' : 'container--desktop'"
>
  <div class="search-container">
    <mat-form-field
      appearance="fill"
      class="search-input"
      [ngClass]="isMobile ? 'search-input--mobile' : 'search-input--desktop'"
    >
      <mat-label>Desde - Hasta</mat-label>
      <mat-date-range-input [formGroup]="dateForm" [rangePicker]="picker">
        <input
          readonly
          matStartDate
          formControlName="start"
          placeholder="Fecha Inicio"
        />
        <input
          readonly
          matEndDate
          formControlName="end"
          placeholder="Fecha Final"
        />
      </mat-date-range-input>
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-date-range-picker #picker></mat-date-range-picker>
    </mat-form-field>
    <mat-form-field
      appearance="fill"
      class="search-input"
      [ngClass]="isMobile ? 'search-input--mobile' : 'search-input--desktop'"
    >
      <mat-label>Filtro por DNI</mat-label>
      <input
        matInput
        [formControl]="dniControl"
        type="text"
        placeholder="Número de DNI"
        autocomplete="off"
      />
    </mat-form-field>
    <mat-form-field
      appearance="fill"
      class="search-input"
      [ngClass]="isMobile ? 'search-input--mobile' : 'search-input--desktop'"
    >
      <mat-label>Filtro por RUC</mat-label>
      <input
        matInput
        [formControl]="rucControl"
        type="text"
        placeholder="Número de RUC"
        autocomplete="off"
      />
    </mat-form-field>
  </div>
  <div
    class="events-container"
    [ngClass]="isMobile ? 'events-container--mobile' : ''"
    *ngIf="access$ | async"
  >
    <div class="table-header">
      <h3>Historial</h3>
      <span class="fill"></span>
      <button
        mat-raised-button
        color="primary"
        style="color: white"
        (click)="downloadXlsx(access)"
      >
      <mat-icon>download</mat-icon>
        Descargar
      </button>
    </div>
    <table
      mat-table
      [dataSource]="accessDataSource"
      matSort
      (matSortChange)="sortData($event)"
    >
      <ng-container matColumnDef="name">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="table__cell"
          mat-sort-header
        >
          Nombre
        </th>
        <td mat-cell *matCellDef="let element" class="table__cell">
          {{ element.name }} {{ element.lastname }}
        </td>
      </ng-container>
      <ng-container matColumnDef="dni">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="table__cell"
          mat-sort-header
        >
          DNI
        </th>
        <td mat-cell *matCellDef="let element" class="table__cell">
          {{ element.dni }}
        </td>
      </ng-container>
      <ng-container matColumnDef="companyName">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="table__cell"
          mat-sort-header
        >
          Empresa
        </th>
        <td mat-cell *matCellDef="let element" class="table__cell">
          {{ element.companyName }}
        </td>
      </ng-container>
      <ng-container matColumnDef="companyRuc">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="table__cell"
          mat-sort-header
        >
          RUC
        </th>
        <td mat-cell *matCellDef="let element" class="table__cell">
          {{ element.companyRuc }}
        </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="table__cell"
          mat-sort-header
        >
          Fecha
        </th>
        <td mat-cell *matCellDef="let element" class="table__cell">
          {{
            element.entryAt
              ? (element.entryAt.seconds * 1000 | date : "dd/MM/yy")
              : ""
          }}
          {{
            element.departureAt
              ? (element.departureAt.seconds * 1000 | date : "dd/MM/yy")
              : ""
          }}
        </td>
      </ng-container>
      <ng-container matColumnDef="entryTime">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="table__cell"
          mat-sort-header
        >
          Ingreso
        </th>
        <td mat-cell *matCellDef="let element" class="table__cell">
          {{
            element.entryAt
              ? (element.entryAt.seconds * 1000 | date : "hh:mm:ss aa")
              : "---"
          }}
        </td>
      </ng-container>
      <ng-container matColumnDef="departureTime">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="table__cell"
          mat-sort-header
        >
          Salida
        </th>
        <td mat-cell *matCellDef="let element" class="table__cell">
          {{
            element.departureAt
              ? (element.departureAt.seconds * 1000 | date : "hh:mm:ss aa")
              : "---"
          }}
        </td>
      </ng-container>
      <ng-container matColumnDef="status">
        <th
          mat-header-cell
          *matHeaderCellDef
          class="table__cell"
          mat-sort-header
        >
          Estado
        </th>
        <td mat-cell *matCellDef="let element" class="table__cell">
          <span
            class="status"
            [ngClass]="
              element.status === 'enabled'
                ? 'status--enabled'
                : 'status--disabled'
            "
          >
            {{ element.status === "enabled" ? "Habilitado" : "Bloqueado" }}
          </span>
        </td>
      </ng-container>
      <tr
        mat-header-row
        *matHeaderRowDef="accessDisplayedColumns; sticky: true"
      ></tr>
      <tr
        mat-row
        *matRowDef="let element; columns: accessDisplayedColumns"
      ></tr>

      <tr class="mat-row" *matNoDataRow>
        <td class="mat-cell" colspan="4">No hay eventos registrados</td>
      </tr>
    </table>
    <mat-paginator
      #accessPaginator
      [pageSizeOptions]="[5, 25, 50]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
</div>
